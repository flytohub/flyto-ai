<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>flyto-ai — 412 modules, one prompt</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#1a1b26;--bg-term:#13141c;--surface:#1e1f2e;
  --border:#2a2b3d;--text:#a9b1d6;--text-dim:#565f89;
  --purple:#bb9af7;--green:#9ece6a;--blue:#7aa2f7;
  --cyan:#7dcfff;--orange:#ff9e64;--red:#f7768e;
  --yellow:#e0af68;
}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center}
a{color:var(--blue);text-decoration:none}
a:hover{text-decoration:underline}

/* Header */
.header{text-align:center;padding:40px 20px 24px;max-width:820px;width:100%}
.header h1{font-size:28px;font-weight:700;color:#fff;margin-bottom:8px}
.header h1 .accent{color:var(--purple)}
.header .tagline{color:var(--text-dim);font-size:15px;margin-bottom:16px}
.header .tagline em{color:var(--green);font-style:normal;font-weight:600}
.gh-link{display:inline-flex;align-items:center;gap:6px;color:var(--text-dim);font-size:13px;border:1px solid var(--border);padding:6px 14px;border-radius:6px;transition:all .2s}
.gh-link:hover{color:var(--blue);border-color:var(--blue);text-decoration:none}
.gh-link svg{width:16px;height:16px;fill:currentColor}

/* Terminal */
.terminal{max-width:820px;width:100%;margin:0 20px;border-radius:12px;border:1px solid var(--border);overflow:hidden;display:flex;flex-direction:column;background:var(--bg-term)}
.titlebar{display:flex;align-items:center;padding:12px 16px;background:var(--surface);border-bottom:1px solid var(--border);gap:8px}
.dots{display:flex;gap:6px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.r{background:#ff5f57}.dot.y{background:#febc2e}.dot.g{background:#28c840}
.titlebar-text{flex:1;text-align:center;font-size:13px;color:var(--text-dim);font-family:'SF Mono',SFMono-Regular,'Fira Code','Cascadia Code',Menlo,Consolas,monospace}
.status{font-size:11px;padding:3px 8px;border-radius:4px;font-weight:500}
.status.online{color:var(--green);background:rgba(158,206,106,.12)}
.status.offline{color:var(--orange);background:rgba(255,158,100,.12)}
.status.checking{color:var(--text-dim);background:rgba(86,95,137,.15)}

/* Output */
.output{flex:1;overflow-y:auto;padding:16px;font-family:'SF Mono',SFMono-Regular,'Fira Code','Cascadia Code',Menlo,Consolas,monospace;font-size:13px;line-height:1.7;min-height:320px;max-height:480px}
.output::-webkit-scrollbar{width:6px}
.output::-webkit-scrollbar-track{background:transparent}
.output::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

.msg{margin-bottom:16px;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
.msg .role{font-size:11px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;font-weight:600}
.msg.user .role{color:var(--blue)}
.msg.assistant .role{color:var(--purple)}
.msg.system .role{color:var(--text-dim)}
.msg .content{white-space:pre-wrap;word-break:break-word}

.tool-call{margin:6px 0;padding:8px 12px;background:rgba(122,162,247,.06);border-left:2px solid var(--blue);border-radius:0 6px 6px 0}
.tool-call .tool-header{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.tool-call .tool-icon{font-size:12px}
.tool-call .tool-name{color:var(--purple);font-weight:600;font-size:12px}
.tool-call .tool-args{color:var(--text-dim);font-size:11px}
.tool-call .tool-result{margin-top:4px;font-size:12px;color:var(--green)}
.tool-call .tool-result.error{color:var(--red)}

/* YAML highlighting */
.yaml-key{color:var(--cyan)}
.yaml-str{color:var(--green)}
.yaml-module{color:var(--purple);font-weight:600}
.yaml-comment{color:var(--text-dim)}

.spinner{display:inline-block;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.cursor{display:inline-block;width:2px;height:14px;background:var(--purple);animation:blink 1s step-end infinite;vertical-align:text-bottom;margin-left:1px}
@keyframes blink{50%{opacity:0}}

/* Input */
.input-row{display:flex;border-top:1px solid var(--border);background:var(--surface)}
.input-row input{flex:1;background:transparent;border:none;color:var(--text);padding:14px 16px;font-family:'SF Mono',SFMono-Regular,'Fira Code','Cascadia Code',Menlo,Consolas,monospace;font-size:13px;outline:none}
.input-row input::placeholder{color:var(--text-dim)}
.input-row button{background:var(--purple);color:#1a1b26;border:none;padding:0 20px;font-weight:600;font-size:13px;cursor:pointer;transition:opacity .2s}
.input-row button:hover{opacity:.85}
.input-row button:disabled{opacity:.4;cursor:not-allowed}

/* Examples */
.examples{max-width:820px;width:100%;padding:20px 20px 0;display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.pill{background:var(--surface);color:var(--text-dim);border:1px solid var(--border);padding:7px 14px;border-radius:20px;font-size:12px;cursor:pointer;transition:all .2s;font-family:'SF Mono',SFMono-Regular,'Fira Code','Cascadia Code',Menlo,Consolas,monospace}
.pill:hover{color:var(--purple);border-color:var(--purple);background:rgba(187,154,247,.08)}

/* Footer */
.footer{text-align:center;padding:28px 20px 40px;max-width:820px;width:100%}
.install-cmd{display:inline-block;background:var(--surface);border:1px solid var(--border);padding:10px 24px;border-radius:8px;font-family:'SF Mono',SFMono-Regular,'Fira Code','Cascadia Code',Menlo,Consolas,monospace;font-size:14px;color:var(--text);margin-bottom:8px}
.install-cmd .prompt{color:var(--green)}
.install-cmd .pkg{color:var(--purple);font-weight:600}
.footer .sub{color:var(--text-dim);font-size:12px;margin-top:8px}

/* Responsive */
@media(max-width:640px){
  .header{padding:20px 16px 16px}
  .header h1{font-size:22px}
  .terminal{margin:0;border-radius:0;border-left:none;border-right:none;flex:1}
  .output{min-height:200px;max-height:none;flex:1}
  .examples{padding:12px 12px 0}
  .pill{font-size:11px;padding:6px 10px}
  .header,.footer{display:none}
  body{display:flex;flex-direction:column;height:100vh}
}
</style>
</head>
<body>

<header class="header">
  <h1><span class="accent">flyto-ai</span></h1>
  <p class="tagline"><em>412 modules</em>, one prompt — browser, API, string, image, file, and more</p>
  <a class="gh-link" href="https://github.com/anthropics/flyto-ai" target="_blank" rel="noopener">
    <svg viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
    GitHub
  </a>
</header>

<div class="terminal">
  <div class="titlebar">
    <div class="dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g"></div></div>
    <span class="titlebar-text">flyto-ai</span>
    <span class="status checking" id="status">checking...</span>
  </div>
  <div class="output" id="output">
    <div class="msg system"><div class="role">system</div><div class="content">Welcome! Type a task below or click an example to start.</div></div>
  </div>
  <div class="input-row">
    <input type="text" id="input" placeholder="Describe a task..." autocomplete="off" autofocus>
    <button id="send" onclick="sendMessage()">Run</button>
  </div>
</div>

<div class="examples" id="examples">
  <span class="pill" onclick="useExample(this)">scrape the title from example.com</span>
  <span class="pill" onclick="useExample(this)">take a screenshot of news.ycombinator.com</span>
  <span class="pill" onclick="useExample(this)">fetch the top 5 Hacker News stories using the API</span>
  <span class="pill" onclick="useExample(this)">extract all links from https://example.com</span>
  <span class="pill" onclick="useExample(this)">convert 'hello world' to uppercase, reverse it, SHA256 hash</span>
  <span class="pill" onclick="useExample(this)">generate 10 random numbers, sort them, calculate average</span>
</div>

<footer class="footer">
  <div class="install-cmd"><span class="prompt">$</span> pip install <span class="pkg">flyto-ai</span></div>
  <div class="sub">Then run <code style="color:var(--cyan)">flyto-ai serve</code> and open this page locally</div>
</footer>

<script>
(function(){
  "use strict";

  var output = document.getElementById("output");
  var input = document.getElementById("input");
  var sendBtn = document.getElementById("send");
  var statusEl = document.getElementById("status");
  var busy = false;
  var serverOnline = false;

  // Health check
  function checkHealth() {
    statusEl.className = "status checking";
    statusEl.textContent = "checking...";
    fetch("/health", {method: "GET"}).then(function(r) {
      if (r.ok) {
        serverOnline = true;
        statusEl.className = "status online";
        statusEl.textContent = "connected";
      } else { setOffline(); }
    }).catch(function() { setOffline(); });
  }

  function setOffline() {
    serverOnline = false;
    statusEl.className = "status offline";
    statusEl.textContent = "offline";
  }

  checkHealth();
  setInterval(checkHealth, 30000);

  // Input handling
  input.addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  window.useExample = function(el) {
    input.value = el.textContent;
    input.focus();
    sendMessage();
  };

  window.sendMessage = function() {
    var text = input.value.trim();
    if (!text || busy) return;

    addMessage("user", text);
    input.value = "";
    setBusy(true);

    if (!serverOnline) {
      runOfflineDemo(text);
      return;
    }

    // Try SSE streaming first, fall back to batch
    tryStreamChat(text).catch(function() {
      return tryBatchChat(text);
    }).catch(function(err) {
      addMessage("system", "Error: " + (err.message || "Request failed"));
    }).finally(function() {
      setBusy(false);
    });
  };

  function setBusy(v) {
    busy = v;
    sendBtn.disabled = v;
    input.disabled = v;
    if (!v) input.focus();
  }

  // SSE streaming
  function tryStreamChat(text) {
    return new Promise(function(resolve, reject) {
      var msgDiv = createAssistantMsg();
      var contentEl = msgDiv.querySelector(".content");
      var buffer = "";
      var gotEvent = false;

      fetch("/chat/stream", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: text})
      }).then(function(response) {
        if (!response.ok) {
          if (response.status === 429) {
            throw new Error("Rate limited — please wait a moment");
          }
          throw new Error("HTTP " + response.status);
        }
        var reader = response.body.getReader();
        var decoder = new TextDecoder();
        var partial = "";

        function pump() {
          return reader.read().then(function(result) {
            if (result.done) {
              if (!gotEvent) return reject(new Error("No SSE events"));
              return resolve();
            }
            partial += decoder.decode(result.value, {stream: true});
            var lines = partial.split("\n");
            partial = lines.pop();

            var eventType = null;
            for (var i = 0; i < lines.length; i++) {
              var line = lines[i];
              if (line.indexOf("event: ") === 0) {
                eventType = line.substring(7).trim();
              } else if (line.indexOf("data: ") === 0) {
                gotEvent = true;
                var data;
                try { data = JSON.parse(line.substring(6)); } catch(e) { continue; }
                handleSSE(eventType || data.type, data, contentEl, msgDiv);
                eventType = null;
              }
            }
            return pump();
          });
        }
        return pump();
      }).catch(reject);
    });
  }

  function handleSSE(type, data, contentEl, msgDiv) {
    if (type === "token") {
      contentEl.textContent += (data.content || "");
      scrollBottom();
    } else if (type === "tool_start") {
      var tc = createToolCall(data.tool_name, data.tool_args);
      msgDiv.appendChild(tc);
      scrollBottom();
    } else if (type === "tool_end") {
      var tools = msgDiv.querySelectorAll(".tool-call");
      if (tools.length > 0) {
        var last = tools[tools.length - 1];
        var icon = last.querySelector(".tool-icon");
        if (icon) icon.textContent = "\u2713";
        if (icon) icon.className = "tool-icon";
        if (data.tool_result) {
          var res = document.createElement("div");
          var isErr = data.tool_result.ok === false;
          res.className = "tool-result" + (isErr ? " error" : "");
          res.textContent = isErr
            ? "Error: " + (data.tool_result.error || "failed")
            : formatResult(data.tool_result);
          last.appendChild(res);
        }
      }
      scrollBottom();
    } else if (type === "result") {
      // Final result — ensure message content is shown
      if (data.message && !contentEl.textContent.trim()) {
        contentEl.textContent = data.message;
      }
      scrollBottom();
    }
  }

  // Batch fallback
  function tryBatchChat(text) {
    return fetch("/chat", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({message: text})
    }).then(function(r) {
      if (!r.ok) {
        if (r.status === 429) throw new Error("Rate limited — please wait a moment");
        throw new Error("HTTP " + r.status);
      }
      return r.json();
    }).then(function(data) {
      return animateBatchResponse(data);
    });
  }

  function animateBatchResponse(data) {
    return new Promise(function(resolve) {
      var msgDiv = createAssistantMsg();
      var contentEl = msgDiv.querySelector(".content");
      var tools = data.tool_calls || [];
      var idx = 0;

      function nextTool() {
        if (idx >= tools.length) {
          typewriter(contentEl, data.message || "(no response)", resolve);
          return;
        }
        var tc = tools[idx];
        var el = createToolCall(tc.name || tc.function, tc.arguments || tc.args || {});
        // Mark as complete immediately in batch mode
        var icon = el.querySelector(".tool-icon");
        if (icon) { icon.textContent = "\u2713"; icon.className = "tool-icon"; }
        if (tc.result) {
          var res = document.createElement("div");
          var isErr = tc.result && tc.result.ok === false;
          res.className = "tool-result" + (isErr ? " error" : "");
          res.textContent = isErr
            ? "Error: " + (tc.result.error || "failed")
            : formatResult(tc.result);
          el.appendChild(res);
        }
        msgDiv.appendChild(el);
        scrollBottom();
        idx++;
        setTimeout(nextTool, 200);
      }
      nextTool();
    });
  }

  // Typewriter
  function typewriter(el, text, cb) {
    var i = 0;
    var highlighted = highlightYaml(text);
    if (highlighted !== text) {
      // Has YAML — render all at once with highlighting
      el.innerHTML = highlighted;
      scrollBottom();
      if (cb) cb();
      return;
    }
    function tick() {
      if (i < text.length) {
        el.textContent += text[i];
        i++;
        scrollBottom();
        setTimeout(tick, 12);
      } else {
        if (cb) cb();
      }
    }
    tick();
  }

  // DOM helpers
  function createAssistantMsg() {
    var div = document.createElement("div");
    div.className = "msg assistant";
    div.innerHTML = '<div class="role">assistant</div><div class="content"></div>';
    output.appendChild(div);
    scrollBottom();
    return div;
  }

  function createToolCall(name, args) {
    var div = document.createElement("div");
    div.className = "tool-call";
    var label = name || "";
    if (name === "execute_module" && args && args.module_id) {
      label = args.module_id;
    }
    var argsStr = "";
    if (args) {
      if (args.module_id) argsStr = formatToolArgs(args);
      else argsStr = truncate(JSON.stringify(args), 120);
    }
    div.innerHTML = '<div class="tool-header"><span class="tool-icon spinner">\u25E6</span>'
      + '<span class="tool-name">' + escHtml(label) + '</span>'
      + (argsStr ? '<span class="tool-args">' + escHtml(argsStr) + '</span>' : '')
      + '</div>';
    return div;
  }

  function formatToolArgs(args) {
    var parts = [];
    var skip = ["module_id"];
    for (var k in args) {
      if (skip.indexOf(k) >= 0) continue;
      var v = args[k];
      if (typeof v === "string") parts.push(k + "=" + truncate(v, 60));
      else if (typeof v === "object") parts.push(k + "=" + truncate(JSON.stringify(v), 60));
      else parts.push(k + "=" + v);
    }
    return parts.join(", ");
  }

  function formatResult(result) {
    if (!result) return "";
    if (result.data !== undefined) {
      var d = result.data;
      if (typeof d === "string") return truncate(d, 200);
      return truncate(JSON.stringify(d, null, 2), 200);
    }
    return truncate(JSON.stringify(result, null, 2), 200);
  }

  function addMessage(role, text) {
    var div = document.createElement("div");
    div.className = "msg " + role;
    div.innerHTML = '<div class="role">' + escHtml(role) + '</div>'
      + '<div class="content">' + escHtml(text) + '</div>';
    output.appendChild(div);
    scrollBottom();
  }

  function scrollBottom() {
    output.scrollTop = output.scrollHeight;
  }

  function escHtml(s) {
    var d = document.createElement("div");
    d.textContent = s;
    return d.innerHTML;
  }

  function truncate(s, n) {
    return s.length > n ? s.substring(0, n) + "\u2026" : s;
  }

  // Minimal YAML highlighting
  function highlightYaml(text) {
    if (text.indexOf("steps:") < 0 && text.indexOf("module:") < 0) return text;
    return text.replace(/^(\s*)([\w_]+)(:)/gm, function(m, sp, key, colon) {
      var cls = "yaml-key";
      if (key === "module") cls = "yaml-module";
      return sp + '<span class="' + cls + '">' + key + colon + '</span>';
    }).replace(/(["'])(.*?)\1/g, '<span class="yaml-str">$&</span>')
      .replace(/(#.*$)/gm, '<span class="yaml-comment">$1</span>');
  }

  // Offline demo
  function runOfflineDemo(text) {
    var msgDiv = createAssistantMsg();
    var contentEl = msgDiv.querySelector(".content");

    var demoTools = [
      {name: "browser.launch", args: {headless: true}, delay: 400},
      {name: "browser.goto", args: {url: "https://example.com"}, delay: 600},
      {name: "browser.extract", args: {selector: "h1"}, delay: 500}
    ];

    if (text.indexOf("screenshot") >= 0) {
      demoTools = [
        {name: "browser.launch", args: {headless: true}, delay: 400},
        {name: "browser.goto", args: {url: "https://news.ycombinator.com"}, delay: 800},
        {name: "browser.screenshot", args: {path: "screenshot.png"}, delay: 600}
      ];
    } else if (text.indexOf("uppercase") >= 0 || text.indexOf("reverse") >= 0 || text.indexOf("hash") >= 0) {
      demoTools = [
        {name: "string.uppercase", args: {text: "hello world"}, delay: 200},
        {name: "string.reverse", args: {text: "HELLO WORLD"}, delay: 200},
        {name: "crypto.hash", args: {text: "DLROW OLLEH", algorithm: "sha256"}, delay: 300}
      ];
    } else if (text.indexOf("random") >= 0 || text.indexOf("sort") >= 0 || text.indexOf("average") >= 0) {
      demoTools = [
        {name: "random.numbers", args: {count: 10, min: 1, max: 100}, delay: 200},
        {name: "array.sort", args: {order: "asc"}, delay: 200},
        {name: "math.average", args: {}, delay: 200}
      ];
    } else if (text.indexOf("API") >= 0 || text.indexOf("Hacker News") >= 0) {
      demoTools = [
        {name: "api.get", args: {url: "https://hacker-news.firebaseio.com/v0/topstories.json"}, delay: 600},
        {name: "array.slice", args: {start: 0, end: 5}, delay: 200},
        {name: "api.get", args: {url: "https://hacker-news.firebaseio.com/v0/item/{id}.json"}, delay: 500}
      ];
    } else if (text.indexOf("link") >= 0 || text.indexOf("extract") >= 0) {
      demoTools = [
        {name: "browser.launch", args: {headless: true}, delay: 400},
        {name: "browser.goto", args: {url: "https://example.com"}, delay: 600},
        {name: "browser.extract", args: {selector: "a", attribute: "href", all: true}, delay: 500}
      ];
    }

    var idx = 0;
    function nextStep() {
      if (idx >= demoTools.length) {
        contentEl.textContent = "";
        typewriter(contentEl, "(This is a simulated demo — run `flyto-ai serve` for live execution)", function() {
          setBusy(false);
        });
        return;
      }
      var t = demoTools[idx];
      var tc = createToolCall(t.name, t.args);
      msgDiv.appendChild(tc);
      scrollBottom();

      setTimeout(function() {
        var icon = tc.querySelector(".tool-icon");
        if (icon) { icon.textContent = "\u2713"; icon.className = "tool-icon"; }
        var res = document.createElement("div");
        res.className = "tool-result";
        res.textContent = "ok";
        tc.appendChild(res);
        scrollBottom();
        idx++;
        setTimeout(nextStep, 150);
      }, t.delay);
    }
    nextStep();
  }

})();
</script>
</body>
</html>
